//apply from: './config.gradle'

import groovy.json.JsonBuilder

// Top-level build file where you can add configuration options common to all sub-projects/modules.

buildscript {

  def usePlugin = true
  rootProject.ext.isLocalMode = project.file('./repos/com/xander/plugin/asm').exists() && usePlugin

  repositories {
    maven { url uri("./repos") }
    maven { url "https://maven.aliyun.com/repository/jcenter" }
    maven { url "https://maven.aliyun.com/repository/google" }
    google()
    jcenter()
  }

  dependencies {
    classpath 'com.android.tools.build:gradle:3.6.1'

    // NOTE: Do not place your application dependencies here; they belong
    // in the individual module build.gradle files
    if (rootProject.ext.isLocalMode) {
      //格式为 --> group:module:version
      classpath "com.xander.plugin:asm:1.0.0"
    }
  }
}

def isWindows() {
  def os_name = System.properties['os.name'].toString().toLowerCase()
  println "os name: ${os_name}"
  return os_name.contains('window')
}

def defCmd() {
  if (isWindows()) return 'gradlew.bat'
  return './gradlew'
}

//task initRepo(type: Exec) {
//  args = [
//    defCmd(),
//    ':xaop-library:clean',
//    ':xaop-library:upload',
//    ':xaop-transform:clean',
//    ':xaop-transform:upload',
//    ':xaop-plugin:clean',
//    ':xaop-plugin:upload',
//    '--info'
//  ]
//  commandLine args
//}
//
//task initPluginLibrary(type: Exec) {
//  args = [defCmd(), ':plugin-library:clean', ':plugin-library:upload', '--info']
//  commandLine args
//}
//
//task initXaopLibrary(type: Exec) {
//  args = [defCmd(), ':xaop-library:clean', ':xaop-library:upload', '--info']
//  commandLine args
//}
//
//task initXaopTransform(type: Exec) {
//  args = [defCmd(), ':xaop-transform:clean', ':xaop-transform:upload', '--info']
//  commandLine args
//}
//
//task initXaopPlugin(type: Exec) {
//  args = [defCmd(), ':xaop-plugin:clean', ':xaop-plugin:upload', '--info']
//  commandLine args
//}

allprojects {
  repositories {
    maven { url uri('../repos') }
    maven { url "https://maven.aliyun.com/repository/jcenter" }
    maven { url "https://maven.aliyun.com/repository/google" }
    google()
    jcenter()
  }

//  configurations {
//    all {
//      resolutionStrategy {
//        eachDependency { dependency ->
//          // 如果有需要修改为统一的库版本可以在这里修改
//          // println new JsonBuilder( dependency ).toPrettyString()
//          if (dependency.requested.group == 'xx.xx.xx' && dependency.requested.name == 'xxxx') {
//            dependency.requested.version = 'xx.xx.xx'
//          }
//        }
//
//        dependencySubstitution {
//          println "useRemote:${remote}"
//          if (!remote) {
//            substitute module("com.xander.xaop:transform:1.0.0") with project("::xaop-transform")
//            substitute module("com.xander.xaop:gradle:1.0.0") with project("::xaop-plugin")
//          }
//        }
//      }
//    }
//  }
}

task clean(type: Delete) {
  delete rootProject.buildDir
}